<!doctype html>
<html lang="id" class="scroll-smooth" id="htmlTag">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="pageTitle">Dashboard — SI JIMITIUS</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#006b6d',
            secondary: '#f2b643',
            accent: '#a22e33',
            dark: '#2f2f3b',
            light: '#f9fafb'
          },
          fontFamily: {
            heading: ['Poppins', 'sans-serif'],
            body: ['Roboto', 'sans-serif']
          },
          boxShadow: {
            card: '0 4px 12px rgba(0,0,0,0.1)',
            cardHover: '0 8px 24px rgba(0,0,0,0.2)'
          }
        }
      }
    }
  </script>

  <!-- Feather Icons -->
  <script src="https://unpkg.com/feather-icons"></script>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="font-body bg-light text-dark dark:bg-dark dark:text-light antialiased">

<!-- Overlay -->
<div id="overlay" class="fixed inset-0 bg-black/50 z-40 hidden"></div>

<!-- Sidebar -->
<aside id="sidebar" class="w-64 h-screen bg-primary dark:bg-dark text-white fixed left-0 top-0 flex flex-col shadow-lg 
      transition-transform transform -translate-x-full md:translate-x-0 z-50">
  <!-- Logo -->
  <div class="flex items-center gap-3 px-6 py-4 border-b border-white/20">
    <img src="https://raw.githubusercontent.com/arnoldjimmy115-bit/puskesmas-assets/main/putih%20logo.png" alt="Logo" class="w-8 h-8">
    <h1 class="font-heading text-lg">SI JIMITIUS</h1>
  </div>

  <!-- User Info -->
  <div class="px-6 py-4 border-b border-white/20">
    <p id="userName" class="font-semibold"></p>
    <p id="userRole" class="text-sm text-secondary"></p>
  </div>

  <!-- Menu -->
  <nav id="menuContainer" class="flex-1 px-4 py-6 space-y-2 overflow-y-auto"></nav>

  <!-- Footer Menu -->
  <div class="px-4 py-4 border-t border-white/20 flex flex-col gap-2">
    <button onclick="logout()" class="flex items-center gap-2 px-3 py-2 rounded-md bg-accent hover:bg-red-700 transition">
      <i data-feather="log-out" class="w-5 h-5"></i> Logout
    </button>
  </div>
</aside>

<!-- Main Content -->
<div class="md:ml-64 flex-1 min-h-screen flex flex-col">
  <!-- Header -->
  <header class="w-full bg-white dark:bg-gray-900 shadow px-4 md:px-6 py-4 flex justify-between items-center">
    <button id="menuToggle" class="md:hidden p-2 rounded-md bg-primary text-white hover:bg-secondary">
      <i data-feather="menu"></i>
    </button>

    <h2 id="headerTitle" class="text-lg md:text-xl font-heading text-primary dark:text-secondary">Dashboard</h2>

    <button onclick="toggleDark()" id="darkToggle" class="p-2 rounded-full bg-secondary text-dark hover:bg-accent hover:text-white transition">
      <i data-feather="moon"></i>
    </button>
  </header>

  <!-- Content -->
  <main class="flex-1 p-4 md:p-8">
    <h3 id="contentTitle" class="text-xl md:text-2xl font-heading mb-6 text-primary dark:text-secondary"></h3>
    <div id="contentCards" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </main>
</div>

<script>
  feather.replace();

  // 🔐 Cek login
  if (!localStorage.getItem("loggedIn")) {
    window.location.href = "../../login.html";
  }

  const userName = localStorage.getItem("username") || "";
  const userRole = localStorage.getItem("role") || "";

  document.getElementById("userName").textContent = userName || "User";
  document.getElementById("userRole").textContent = userRole || "Koordinator";

  // 🔹 Definisi konten berdasarkan role
  const roleConfig = {
    "Koordinator Promkes": {
      header: "Dashboard — Promkes",
      title: "Fungsi Koordinator Promkes",
      menu: [
        { icon: "calendar", text: "Kelola Jadwal Bulanan" },
        { icon: "send", text: "Distribusi Jadwal" },
        { icon: "file-text", text: "Surat Tugas & SPPD" },
        { icon: "check-square", text: "Monitoring Kegiatan" }
      ],
      cards: [
        { icon: "calendar", title: "Kelola Jadwal Bulanan", desc: "Menyusun & mengunggah jadwal kegiatan rutin setiap bulan." },
        { icon: "send", title: "Distribusi Jadwal", desc: "Mengirimkan jadwal ke Admin TU & pegawai terkait." },
        { icon: "file-text", title: "Surat Tugas & SPPD", desc: "Koordinasi dengan Admin TU untuk penerbitan surat tugas & SPPD." },
        { icon: "check-square", title: "Monitoring Kegiatan", desc: "Memonitor kegiatan menggunakan lembar monitoring." }
      ]
    },
    "Koordinator Kesling": {
      header: "Dashboard — Kesehatan Lingkungan",
      title: "Fungsi Koordinator Kesling",
      menu: [
        { icon: "calendar", text: "Kelola Jadwal Pemeriksaan" },
        { icon: "droplet", text: "Pemeriksaan Air & Sanitasi" },
        { icon: "file-text", text: "Laporan Kesling" },
        { icon: "check-square", text: "Monitoring & Evaluasi" }
      ],
      cards: [
        { icon: "calendar", title: "Kelola Jadwal Pemeriksaan", desc: "Menyusun jadwal kegiatan rutin pemeriksaan kesehatan lingkungan." },
        { icon: "droplet", title: "Pemeriksaan Air & Sanitasi", desc: "Mengelola kegiatan pemeriksaan kualitas air & sanitasi lingkungan." },
        { icon: "file-text", title: "Laporan Kesling", desc: "Mengirimkan laporan hasil pemeriksaan kesehatan lingkungan." },
        { icon: "check-square", title: "Monitoring & Evaluasi", desc: "Melakukan monitoring & evaluasi kegiatan kesehatan lingkungan." }
      ]
    }
  };

  // 🔹 Load konten sesuai role
  if (roleConfig[userRole]) {
    const cfg = roleConfig[userRole];

    document.getElementById("pageTitle").textContent = cfg.header;
    document.getElementById("headerTitle").textContent = cfg.header;
    document.getElementById("contentTitle").textContent = cfg.title;

    // Menu sidebar
    const menuHTML = cfg.menu.map(m => `
      <a href="#" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-secondary hover:text-dark transition">
        <i data-feather="${m.icon}" class="w-5 h-5"></i> ${m.text}
      </a>`).join("");
    document.getElementById("menuContainer").innerHTML = menuHTML;

    // Cards konten
    const cardHTML = cfg.cards.map(c => `
      <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-card hover:shadow-cardHover transition">
        <i data-feather="${c.icon}" class="w-10 h-10 text-secondary mb-4"></i>
        <h4 class="font-bold text-lg mb-2">${c.title}</h4>
        <p class="text-sm text-gray-500 dark:text-gray-300">${c.desc}</p>
      </div>`).join("");
    document.getElementById("contentCards").innerHTML = cardHTML;

    feather.replace();
  } else {
    Swal.fire({
      icon: 'warning',
      title: 'Akses Ditolak',
      text: 'Role Anda tidak dikenali.',
      timer: 1800,
      showConfirmButton: false
    }).then(() => {
      window.location.href = "../../index.html";
    });
  }

  // 🔹 Dark mode toggle
  const htmlTag = document.getElementById("htmlTag");
  const darkToggle = document.getElementById("darkToggle");
  function toggleDark() {
    const isDark = htmlTag.classList.toggle("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
    darkToggle.innerHTML = isDark ? feather.icons.sun.toSvg() : feather.icons.moon.toSvg();
    feather.replace();
  }
  if(localStorage.getItem("theme") === "dark"){ 
    htmlTag.classList.add("dark"); 
    toggleDark(); 
  }

  // 🔹 Sidebar toggle
  const sidebar = document.getElementById("sidebar");
  const menuToggle = document.getElementById("menuToggle");
  const overlay = document.getElementById("overlay");
  function closeSidebar() {
    sidebar.classList.add("-translate-x-full");
    overlay.classList.add("hidden");
  }
  if (menuToggle) {
    menuToggle.addEventListener("click", () => {
      sidebar.classList.toggle("-translate-x-full");
      overlay.classList.toggle("hidden");
    });
  }
  if (overlay) {
    overlay.addEventListener("click", closeSidebar);
  }

  // 🔹 Logout
  function logout() {
    Swal.fire({
      title: 'Apakah Anda yakin ingin logout?',
      text: "Sesi Anda akan diakhiri.",
      icon: 'question',
      iconColor: '#a22e33',
      showCancelButton: true,
      confirmButtonText: '<i data-feather="log-out"></i> Ya, Logout',
      cancelButtonText: 'Batal',
      confirmButtonColor: '#d33',
      cancelButtonColor: '#6c757d',
      reverseButtons: true
    }).then((result) => {
      if (result.isConfirmed) {
        localStorage.clear();
        Swal.mixin({
          toast: true,
          position: 'top-end',
          showConfirmButton: false,
          timer: 2000,
          timerProgressBar: true
        }).fire({
          icon: 'success',
          title: 'Berhasil logout'
        }).then(() => {
          window.location.href = "../../login.html";
        });
      }
    });
  }
</script>
</body>
</html>
